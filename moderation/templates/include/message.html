{% load i18n %}
{% with wrapper.message as message %}
    <div class="media">
        <p class="pull-left {% if wrapper.needs_action %}text-danger{% else %}text-success{% endif %}">
        {% if wrapper.created_by_moderator %}
            <span class="glyphicon glyphicon-repeat conversation-icon" data-placement="top" data-toggle="tooltip" title="{% trans "This message was created by a moderator"%}"></span>
        {% elif message.direction = "I" %}
            <span class="glyphicon glyphicon-envelope conversation-icon" data-placement="top" data-toggle="tooltip" title="{% trans "This message was sent by a user to SIM"%}"></span>
        {% else %}
            <span class="glyphicon glyphicon-open conversation-icon" data-placement="top" data-toggle="tooltip" title="{% trans "This message was sent by SIM to a user"%}"></span>
        {% endif %}
        </p>
        <div class="media-body">
            <h4 class="media-heading {% if wrapper.needs_action %}text-danger{% else %}text-success{% endif %}">{{ message.text }}</h4>
            <table class="table table-condensed">
                <tr>
                    <td>{% trans "Date" %}</td>
                    <td>{{ message.date }}</td>
                </tr>
                <tr>
                    <td>{% trans "Phone Number" %}</td>
                    <td>{{ message.connection.identity }}</td>
                </tr>
            </table>

            <!-- Message Effects -->
            {% if message.direction = "I" %}
                <table class="table table-condensed small">
                    <thead>
                        <tr>
                            <th>{% trans "Stage" %}</th>
                            <th>{% trans "Priority" %}</th>
                            <th>{% trans "Operation" %}</th>
                            <th>{% trans "Name" %}</th>
                            <th>{% trans "Description" %}</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for effect_wrapper in wrapper.wrapped_effects %}
                            {% include "include/effect.html" %}
                        {% endfor %}
                    </tbody>
                </table>
            {% endif %}
        </div>
    </div>
{% endwith %}